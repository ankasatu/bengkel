<html>

<head>
    <title>Bengkel - Base64 image utils</title>
    <link rel="stylesheet" href="/bengkel/template/style/main.css">
    <style>
        .context .result textarea {
            display: block;
            min-width: 100%;
            min-height: 100%;
            max-width: 100%;
            max-height: 100%;
            resize: none;
        }

        .context .image-preview {
            width: 150px;
            padding: 5px;
            border-radius: var(--io-border-radius);
        }

        .context .image-preview img {
            max-width: 100%;
            max-height: 100%;
            margin: auto;
        }
    </style>
    <script type="text/javascript">
        function __ls__(a = [], b = () => { }) { function c() { ++d == a.length && b() } for (var d = 0, e = 0; e < a.length; e++) { const b = a[e], d = document.createElement("script"); d.src = b + (-1 == b.indexOf("?") ? "?" : "") + "r=" + Math.random(), d.onload = c, document.head.appendChild(d) } }
        function __lb__(a) { function b(a, b) { if (b instanceof Node) a.appendChild(b); else if (b.node instanceof Node) a.appendChild(b.node); else throw new Error("arg or arg.node is not instance of Node") } var d = a.cloneNode(!0), e = () => { }, f = { node: d, classList(...a) { for (var b, e = 0; e < a.length; e++) { b = a[e].split(" "); for (var g = 0; g < b.length; g++)d.classList.add(b[g]) } return f }, setTitle(a) { return d.title = a, f }, setValue(a) { return d.value = a, f }, setInnerHTML(a) { return d.innerHTML = a, f }, setInnerText(a) { return d.innerText = a, f }, appendChild(...a) { for (var c = 0; c < a.length; c++)b(d, a[c]); return f }, appendTo(a) { return b(a, d), f }, setStyle(a) { return d.style = a, f }, setSrc(a) { return d.src = a, f }, onClick(a) { return e = d.onclick = () => a(d), f }, onChange(a) { return e = d.onchange = b => a(d, b), f }, eventExec(a) { d[a.toLowerCase()]() }, exec() { return e(), f }, remove() { d.remove() } }; return f }
    </script>
</head>

<body>

    <div class="wrapper">
    </div>
    <script type="text/javascript">

        (function () {
            var _ = __lb__;

            var div = document.createElement("div");

            var image = document.createElement("img");
            image.classList.add("bkl-image");

            var textarea = document.createElement("textarea");
            textarea.classList.add("bkl-textarea", "readonly");
            textarea.spellcheck = false;
            textarea.readOnly = true;

            var button = document.createElement("button");
            button.classList.add("bkl-button");

            var form = document.createElement("form");
            form.hidden = true;
            var inputfile = document.createElement("input");
            inputfile.type = "file";
            inputfile.multiple = true;

            function freader(file, callback) {
                try {
                    if (!file) {
                        throw new Error("No file selected.");
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (event) {
                        callback({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: event.target.result,
                            value: event.target.result.split(',')[1],
                        });
                    };

                    reader.readAsDataURL(file);
                } catch (e) {
                    callback({
                        name: "error",
                        value: e.message,
                    })
                }
            }

            function coder({ data, value }) {
                var context = _(div).classList("context");
                var imageWrapper = _(div).classList("shrink", "image-preview", "bg-chess");
                var previewResult = _(div).classList("grow", "result");

                context.appendChild(imageWrapper, previewResult);

                _(image).appendTo(imageWrapper).setSrc(data);
                _(textarea).appendTo(previewResult).setValue(value);

                return context;
            }

            function main(_wrapper, _b) {
                var inputform = _(form);
                var input = _(inputfile).appendTo(inputform);

                function clear() {
                    input.node.value = null;
                }

                function render(data) {
                    var ctx = coder(data);
                    var content = _b.playground.create(ctx.node).setTitle(data.name);
                    _wrapper.appendChild(content.node);
                }

                function control() {
                    return _b.playground.manager
                        .register((action) => action.setInnerText("Load Image(s)")
                            .onClick(() => { input.node.click(); })
                        )
                        .node;

                }

                input.onChange((node, e) => {
                    for (var i = 0; i < node.files.length; i++) {
                        const file = node.files[i];
                        setTimeout(() => {
                            freader(file, render);
                        }, 10 * i);
                    }
                    clear();
                });

                _wrapper.appendChild(inputform.node);

                return { control };
            }

            __ls__([
                '/bengkel/bengkel.base64.js',
                '/bengkel/bengkel.playground.js',
            ], function () {

                var wrapper = document.querySelector('.wrapper');

                var form = main(wrapper, __bengkel__);

                wrapper.appendChild(form.control());
            });
        })();



    </script>
</body>

</html>